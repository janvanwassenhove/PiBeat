# --Synaptic Drift--
# Generated by mITy.John music's agency.
use_bpm 130

# === GLOBALS ===
set :pause_all, false
set :stop_all, false
set :master_amp, 1.0

# Fade-out & Stop Timer
in_thread do
  sleep 300  # start fade-out at 3:20
  40.times do |i|
    set :master_amp, 1.0 - (i + 1) * 0.025
    sleep 1
  end
  set :stop_all, true
end

# Helper for master volume scaling
define :amp_mod do |v|
  return v * get(:master_amp)
end

# === DEFINITIES ===

define :kick do
  sample :bd_haus, amp: amp_mod(2)
end

define :hihat do
  sample :drum_cymbal_closed, amp: amp_mod(0.4), rate: 2
end

define :snare do
  sample :sn_dub, amp: amp_mod(1.5)
end

define :acid_bass do |n|
  use_synth :tb303
  play_pattern_timed scale(n, :minor_pentatonic, num_octaves: 1), 0.25,
    release: 0.2, cutoff: 90, res: 0.9, wave: 0, amp: amp_mod(1)
end

define :melody_hook do
  use_synth :blade
  play_pattern_timed [:e4, :g4, :b4, :g4, :e4, :g4, :b4, :g5],
    [0.25]*8, release: 0.3, cutoff: 100, amp: amp_mod(1)
end

# === BEAT STRUCTUUR ===

live_loop :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  kick
  sleep 1
end

live_loop :hihat_loop do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  sleep 0.5
  hihat
end

live_loop :snare_loop do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  sleep 1
  sync :beat
  snare
  sleep 1
end

# === BUILD-UP 1 ===

with_fx :reverb, mix: 0.4 do
  live_loop :intro_bass, sync: :beat do
    if get(:stop_all) || get(:pause_all); sleep 1; next; end
    sleep 6
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
    sleep 2
    4.times do
      acid_bass :e2
    end
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
    sleep 6
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
    stop
  end
end

sleep 24

# === REFREIN ===

live_loop :hook, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  melody_hook
  sleep 2
end

live_loop :vocal_intro, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  sleep 4
  with_fx :reverb, room: 0.9, mix: 0.6 do
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  end
  sleep 8
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  stop
end

# === DROP 1 ===

live_loop :drop_bass, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  use_synth :tb303
  play_pattern_timed [:e2, :e2, :g2, :b1].ring, 0.25,
    release: 0.15, cutoff: 110, res: 0.95, wave: 1, amp: amp_mod(1)
end

live_loop :drop_fx, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  with_fx :distortion, mix: 0.5 do
    sample :bass_voxy_hit_c, rate: 0.5, amp: amp_mod(1.5)
  end
  sleep 4
end

live_loop :drop_loop_sample, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  sample "/mnt/data/loop15_keyBmin_130bpm.wav", amp: amp_mod(2.2), beat_stretch: 4
  sleep 4
end

# === BREAKDOWN ===

sleep 32

live_loop :breakdown_hook, sync: :beat do
  if get(:stop_all) || get(:pause_all); sleep 1; next; end
  2.times do
    melody_hook
    sleep 2
  end
  stop
end

sleep 8  # ademruimte

live_loop :mid_break do
  sleep 60
  set :pause_all, true
  
  in_thread do
    sleep 2
    sample :ambi_glass_rub, rate: 0.4, amp: 0.5
  end
  
  sleep 12 # echte pauze
  
  in_thread do
    with_fx :reverb, room: 0.9, mix: 0.6 do
      sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav",
        amp: 3, pitch: -2
    end
    sleep 8  # laten klinken
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
    sleep 12
  end
  sleep 16  # laat samples uitklinken
  set :pause_all, false
  cue :mid_break_done  # signaal om opnieuw te starten
  stop
end


# === BUILD-UP 2 ===

live_loop :build2, sync: :mid_break_done  do
  if get(:stop_all); stop; end
  sleep 6
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  sleep 2
  4.times do
    acid_bass :e2
  end
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  sleep 6
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  stop
end

sleep 8

# === DROP 2 ===

live_loop :drop2_fx, sync: :mid_break_done do
  if get(:stop_all); stop; end
  with_fx :bitcrusher, bits: 6, sample_rate: 8000, mix: 0.4 do
    if one_in(2)
      sample :bass_voxy_hit_c, rate: 0.5, amp: amp_mod(1)
    end
  end
  sleep 4
end

live_loop :drop2_bass, sync: :mid_break_done do
  if get(:stop_all); stop; end
  use_synth :prophet
  notes = (scale :g2, :minor_pentatonic).shuffle
  8.times do
    play notes.tick, release: 0.3, cutoff: rrand(80, 120), amp: amp_mod(0.8)
    sleep 0.25
  end
end

live_loop :drop2_melody, sync: :mid_break_done do
  if get(:stop_all); stop; end
  use_synth :gabberkick
  with_fx :echo, phase: 0.25, mix: 0.4 do
    n = [:d4, :g4, :a4, :b4].ring.tick
    play n, release: rrand(0.2, 0.4), amp: amp_mod(0.5 + rrand(0, 0.3))
  end
  sleep 0.5
end

# === VOCAL ADRENALINE INJECTION ===

live_loop :vocal_adrenaline, sync: :mid_break_done do
  if get(:stop_all); stop; end
  sleep 8  # beetje spanning opbouwen
  with_fx :echo, phase: 0.75, mix: 0.3 do
    with_fx :reverb, room: 0.9, mix: 0.5 do
      sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav",
        amp: amp_mod(3), pitch: -1
    end
  end
  sleep 10  # laat sample uitklinken
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  sleep 2
  stop
end

# === OUTRO ===

sleep 16

live_loop :outro_bass, sync: :mid_break_done do
  if get(:stop_all); stop; end
  4.times do
    use_synth :dsaw
    play :e2, release: 1, amp: amp_mod(0.6)
    sleep 1
  end
  stop
end

live_loop :vocal_outro, sync: :mid_break_done do
  if get(:stop_all); stop; end
  sleep 4
  with_fx :gverb, room: 30, mix: 0.6 do
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  end
  sleep 8
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav",
    stop
end

live_loop :vocal_duet_outro, sync: :mid_break_done do
  if get(:stop_all); stop; end
  
  with_fx :reverb, room: 0.9, mix: 0.6 do
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav",
      amp: amp_mod(2.5), pitch: -2
  end
  sleep 4
  
  with_fx :echo, phase: 0.75, mix: 0.4 do
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav",
      amp: amp_mod(2.5), pitch: -1
  end
  sleep 4
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(2.5), pitch: -1
  stop  # 1x uitvoeren
end

# === AFTERGLOW ===
define :explosion_fx do
  in_thread do
    # Low-frequency boom (bass drum stretched)
    sample :bd_tek, rate: 0.5, amp: 2
  end
  
  in_thread do
    # Noise burst
    synth :noise, release: 1.5, amp: 2
  end
  
  in_thread do
    # Rumble (long, slow growl)
    synth :bnoise, attack: 0.1, release: 6, cutoff: 60, amp: 2
  end
  
  in_thread do
    # Metallic debris (fast clicky hits)
    6.times do
      sample :elec_blip2, rate: rrand(0.3, 1.5), amp: rrand(0.3, 0.6)
      sleep rrand(0.05, 0.2)
    end
  end
end

live_loop :explosion do
  sync :boom
  explosion_fx
  stop
end

live_loop :afterglow do
  sleep 210
  6.times do
    
    with_fx :reverb, room: 1, mix: 0.8 do
      with_fx :echo, phase: 1.25, mix: 0.4 do
        sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav",
          amp: 2, pitch: -2, rate: 0.5
      end
    end
    sleep 6
    
    with_fx :reverb, room: 1, mix: 0.8 do
      with_fx :echo, phase: 1.25, mix: 0.5 do
        sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav",
          amp: 2, pitch: -2, rate: 0.5
      end
    end
    sleep 6
  end
  with_fx :gverb, room: 30, mix: 0.6 do
    sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Imagination_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  end
  sleep 8
  sample "C:/Development/Workspaces/sonicpi/songs_approved/Imagination/ES_LNGUE_Spoken_Female_Adrenaline_Wet_130bpm.wav", amp: amp_mod(3), pitch: -2
  cue :boom
  stop
end


